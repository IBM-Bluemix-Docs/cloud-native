---

copyright:
  years: 2019
lastupdated: "2019-04-08"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:important: .important}

# 何謂雲端原生？
{: #overview}

雲端運算環境是動態的，可隨需應變配置及釋放虛擬化共用儲存區中的資源。相較於通常用於傳統內部部署資料中心的前期資源配置，這些彈性環境啟用更具彈性的調整選項。
{:shortdesc}

根據[雲端原生運算基礎](https://cncf.io/about/charter){: new_window} ![外部鏈結圖示](../icons/launch-glyph.svg "外部鏈結圖示")，雲端原生系統具有下列屬性：

- 在軟體容器中，應用程式或處理程序以隔離單元形式執行。
- 處理程序由中央編排處理程序管理，用來改善資源使用率並降低維護成本。
- 應用程式或服務（微服務）與明確說明的相依關係鬆散連結。

這些屬性說明一個高度動態的系統，此系統由一起運作的獨立處理程序組成用來提供商業價值：分散式系統。

分散式運算是一個可以追溯到幾十年前的概念。[分散式運算的謬誤](http://www.rgoarchitects.com/Files/fallacies.pdf){: new_window} ![外部鏈結圖示](../icons/launch-glyph.svg "外部鏈結圖示") 擷取由分散式系統架構設計師和設計師所做的下列假設（從長遠來看，證明是錯誤的）。 

* 網路是可靠的。
* 網路是安全的。
* 網路是同質的。
* 延遲為零。
* 頻寬無限。
* 拓蹼不會變更。
* 有一位管理者。
* 傳輸成本為零。

Kubernetes 及 Istio 這類雲端技術旨在解決基礎架構本身的這些疑慮。

## 十二個因素
{: #twelve-factors}

[十二因素應用程式](http://12factor.net){: new_window} ![外部鏈結圖示](../icons/launch-glyph.svg "外部鏈結圖示") 方法是由 Heroku 的開發人員起草。十二因素中所提及的特徵並不專屬於雲端提供者、平台或語言。這些因素代表一組適用於可在雲端環境中成長之可攜式回復型應用程式的準則或最佳作法（特別是「軟體即服務 (SaaS)」應用程式）。下列清單提供十二因素：

1. 在 Git 儲存庫這類已版本化程式碼庫與已部署服務之間具有一對一關聯。相同的程式碼庫可用於多個部署。
2. 服務會明確宣告所有相依關係，且不依賴是否存在系統層次工具或程式庫。
3. 部署環境之間的不同配置儲存在環境中，特別是在環境變數中。
4. 所有支援服務都會被視為是由執行環境所管理（連接及分離）的已連接資源。
5. 交付管線具有嚴格區隔的階段：建置、釋放、執行。
6. 應用程式會部署為一個以上的無狀態處理程序。具體而言，暫時性處理程序是無狀態的，且無法共用。持續保存的資料會儲存在適當的支援服務中。
7. 藉由接聽指定的埠，自行包含服務可讓其他服務使用它們。
8. 藉由調整個別處理程序（水平調整）來達到並行。
9. 處理程序是可移除的：快速啟動及循序關閉行為會導致更健全且具復原力的系統。
10. 從本端開發到正式作業的所有環境都盡可能類似。
11. 應用程式會將日誌產生為事件串流（例如，寫入至 `stdout` 和 `stderr`），並信任執行環境聚集串流。
12. 如果需要一次性管理作業，則會將它們保留在來源控制中，並與應用程式一起包裝，以確保使用與應用程式相同的環境來執行它們。

您不需要嚴格遵循這些因素來實現一個高品質的微服務環境；不過，記住它們可讓您在持續交付環境中建置並維護可攜式應用程式或服務。

## 微服務
{: #microservices}

*微服務* 是一組小型的獨立架構元件，每個元件都具有單一用途，可透過一般輕量型 API 進行通訊。下列簡單範例中的每個微服務都是一個十二因素應用程式，使用可更換的支援服務來儲存資料及傳遞訊息。

![微服務應用程式](images/microservice.png "微服務應用程式"){: caption="圖 1. 微服務應用程式" caption-side="bottom"}

微服務是獨立的。靈活性是微服務架構的其中一個好處，但只有在服務能夠在不干擾其他服務的情況下被完全重新撰寫時才存在。這種情況不可能經常發生，但它解釋了此需求。清楚的 API 界限可讓在服務上工作的團隊能夠最靈活地發展實作。此特徵可實現多國語言程式設計和持續性。

微服務具復原力。應用程式穩定性取決於個別微服務是否夠健全不會導致失敗。這是與傳統架構的巨大差異，其中，支援的基礎架構會為您處理失敗。每個服務都需要套用斷路器和隔板這類隔離型樣來包含故障，並定義適當的撤回行為來保護上游服務。

微服務是無狀態的暫時性處理程序。這與指出微服務不能有狀態是不一樣的！這表示應該將狀態儲存在 Redis 這類外部支援雲端服務中，而不是在記憶體內。快速啟動和循序關閉行為可進一步讓微服務在自動化環境中良好運作，自動化環境會建立及破壞實例以回應負載或維護系統性能狀態。

### 「小型」的意義
{: #small-microsvc}

使用套用至微服務的「小型」這個詞，基本上表示它專注於目的：它應該做一件事，而且把這件事做好。許多說明都讓個別微服務的角色與 Unix 指令行上的鏈結指令平行：

```
ls | grep 'service' | sort -r
```
{:pre}

這些 Unix 指令各執行完全不同的作業，而且不論程式設計語言或程式碼數量為何，您都可以將它們鏈結在一起。

## 多國語言應用程式：為工作選擇正確的工具
{: #polyglot-apps}

多國語言是微服務型架構的常用好處。一方面，可讓您選擇服務所提供功能的適當語言或資料儲存庫，其功能可能非常強大，並且帶來很大的效率。另一方面，使用遮蔽技術會讓長期維護更為複雜，並禁止在團隊之間移動開發人員。 

建立這兩者的平衡，方法是建立一份在一開始時可供選擇的受支援技術清單，且在一段時間後利用已定義的原則使用新的技術來延伸清單。請確定可以滿足可維護性、審核性及資料安全這類非功能或法規需求，同時保留靈活性以及支援透過實驗進行創新。

## REST 和 JSON
{: #rest-json}

只有不限語言的通訊協定才能使用多國語言應用程式。REST 架構型樣會定義用於建立統一介面的準則，這些介面會將線上資料表示法與服務的實作分開。

JSON 已使用選擇的文字型資料發訊格式電子統合至微服務架構，並使用其相對簡單和簡潔的方式來取代 XML。相較之下，下列範例是在 JSON 中包含員工資料的基本記錄：

  ```json
{
  "name": "Marley Cassin",
  "serial": 228264,
  "title": "Senior Software Engineer",
  "address": {
    "office": "501-B101",
    "street": "3858 Kuvalis Pass",
    "city": "East Craig",
    "state": "NC",
    "zip": "64519-8934"
  }
}
```
{: codeblock}

而下列範例是 XML 中的相同員工記錄：

```xml
<person>
  <name>Marley Cassin</name>
  <serial>228264</serial>
  <title>Senior Software Engineer</title>
  <address>
    <office>501-B101</office>
    <street>3858 Kuvalis Pass</street>
    <city>East Craig</city>
    <state>NC</state>
    <zip>64519-8934</zip>
  </address>
</person>
```
{: codeblock}

JSON 使用屬性值配對來代表簡要語法中的資料物件，而簡要語法保留一些基本類型（例如數字、字串、陣列及物件）的相關資訊。JSON 和 XML 都清楚地代表先前範例中的巢狀位址物件，但您需要有關聯的 XML 綱目才能判定 `serial` 元素的類型。在 JSON 中，該語法清楚地表明 `serial` 的值是一個數字，而非字串。
